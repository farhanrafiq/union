# Render Deployment Checklist

## ‚úÖ What Was Done

1. **Removed localStorage** - All auth now uses HttpOnly cookies
2. **Added cookie-based authentication** - Secure session management
3. **Updated render.yaml** - Auto-links FRONTEND_ORIGIN and VITE_API_URL
4. **Simplified configuration** - No localhost setup needed
5. **All changes pushed to GitHub** - Ready for Render deployment

---

## üöÄ Deploy to Render (Do This Now)

### Step 1: Create Neon Database
1. Go to [console.neon.tech](https://console.neon.tech)
2. Click **"New Project"**
3. Copy the connection string (starts with `postgresql://`)

### Step 2: Deploy via Blueprint

**Option A: Fresh Deployment (Recommended)**
1. Go to [dashboard.render.com](https://dashboard.render.com)
2. Click **"New"** ‚Üí **"Blueprint"**
3. Connect your GitHub repo: `farhanrafiq/union`
4. Render will automatically:
   - Create backend service: `union-registry-api`
   - Create frontend service: `union-registry-frontend`
   - Auto-link `VITE_API_URL` and `FRONTEND_ORIGIN`

**Option B: Update Existing Services**
1. Delete your current services on Render
2. Follow Option A above

### Step 3: Set Database URL
1. In Render Dashboard ‚Üí `union-registry-api` service
2. Go to **Environment** tab
3. Find `DATABASE_URL` ‚Üí Click **"Edit"**
4. Paste your Neon connection string
5. Click **"Save Changes"**
6. Service will auto-redeploy

### Step 4: Verify Deployment
1. Wait for both services to deploy (3-5 minutes)
2. Click on `union-registry-frontend` ‚Üí Copy the URL
3. Visit the URL in your browser
4. You should see the login page (NOT "API not configured")

### Step 5: Seed Database (First Time Only)
1. Go to `union-registry-api` service
2. Click **"Shell"** tab
3. Run:
   ```bash
   npm run seed
   ```
4. This creates demo dealer: `dealer1` / `Union@2025`

---

## ‚úÖ Verification Steps

### Test Login
1. Go to your frontend URL
2. Click **"Dealer Login"**
3. Enter: `dealer1` / `Union@2025`
4. Should successfully login

### Test Cookie Auth
1. After login, open browser DevTools
2. Go to **Application** ‚Üí **Cookies**
3. Should see a cookie named `token` (HttpOnly)
4. Refresh the page ‚Üí Should stay logged in

### Test Database Persistence
1. Create an employee or customer
2. Logout
3. Login again ‚Üí Data should still be there

### Test Cross-Device
1. Login on one device/browser
2. Create an employee
3. Login on another device/browser with same credentials
4. Employee should appear ‚Üí Confirms Neon DB is working

---

## üêõ Troubleshooting

### "API not configured" Error
**Cause**: `VITE_API_URL` not set in frontend build

**Fix**:
1. Go to Render ‚Üí `union-registry-frontend`
2. **Environment** tab
3. Verify `VITE_API_URL` exists and points to backend
4. **Manual Deploy** ‚Üí **"Clear build cache & deploy"**

### CORS Errors
**Cause**: `FRONTEND_ORIGIN` not set on backend

**Fix**:
1. Go to Render ‚Üí `union-registry-api`
2. **Environment** tab
3. Add `FRONTEND_ORIGIN` = your frontend URL
4. Save (auto-redeploys)

### Database Connection Errors
**Cause**: Invalid `DATABASE_URL`

**Fix**:
1. Verify Neon connection string is correct
2. Ensure it ends with `?sslmode=require`
3. Check Neon dashboard - database may be paused

### Login Not Working
**Cause**: Database not seeded

**Fix**:
1. Go to backend service **Shell**
2. Run: `npm run seed`
3. Try login again

---

## üìä Expected Environment Variables

### Backend Service (`union-registry-api`)
```
DATABASE_URL=postgresql://user:pass@host.neon.tech/dbname?sslmode=require
JWT_SECRET=<auto-generated by Render>
NODE_ENV=production
FRONTEND_ORIGIN=https://union-registry-frontend.onrender.com
PORT=8080
```

### Frontend Service (`union-registry-frontend`)
```
VITE_API_URL=https://union-registry-api.onrender.com
```

---

## üéâ Success Criteria

- ‚úÖ Frontend loads without "API not configured" error
- ‚úÖ Can login with `dealer1` / `Union@2025`
- ‚úÖ Cookie is set (check DevTools)
- ‚úÖ Page refresh keeps you logged in
- ‚úÖ Can create employees/customers
- ‚úÖ Data persists after logout/login
- ‚úÖ Data syncs across multiple browsers/devices

---

## üîÑ Future Updates

After making code changes:
```bash
git add .
git commit -m "Your changes"
git push origin main
```

Render will automatically redeploy both services.

---

## üìû Need Help?

- Check Render logs: Service ‚Üí **Logs** tab
- Check backend health: `https://your-api.onrender.com/health`
- GitHub Issues: [farhanrafiq/union](https://github.com/farhanrafiq/union/issues)
