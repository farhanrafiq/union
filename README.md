<div align="center">
<img width="1200" height="475" alt="GHBanner" src="https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6" />
</div>

# Run and deploy your AI Studio app

This contains everything you need to run your app locally.

View your app in AI Studio: https://ai.studio/apps/drive/11fGBCY5TvCYgSimd4g6-LNbc-4RrgIFG

## Run Locally (Full Stack)

### Frontend Only (localStorage mode)
**Prerequisites:** Node.js

1. Install dependencies:
   `npm install`
2. Run the app:
   `npm run dev`
3. Data stored in browser only (not synced across devices)

### With Backend API (Cross-device sync)

**Prerequisites:** Node.js, PostgreSQL or Neon account

1. **Setup Backend**:
   ```bash
   cd server
   npm install
   ```

2. **Configure Database**:
   - Create Neon database at [neon.tech](https://neon.tech) (free tier) OR use local PostgreSQL
   - Copy `server/.env.example` to `server/.env`
   - Set `DATABASE_URL` to your connection string
   - Set `JWT_SECRET` (generate with: `openssl rand -hex 32`)

3. **Initialize Database**:
   ```bash
   cd server
   npm run generate  # Generate Prisma client
   npm run migrate   # Run migrations
   npm run seed      # Create demo data (dealer1 / Union@2025)
   npm run dev       # Start backend on :8080
   ```

4. **Setup Frontend**:
   ```bash
   cd ..  # Back to project root
   npm install
   ```
   - Copy `.env.example` to `.env.local`
   - Set `VITE_API_URL=http://localhost:8080`

5. **Run Frontend**:
   ```bash
   npm run dev  # Start frontend on :5173
   ```

6. **Test**: Open `http://localhost:5173` and login with `dealer1` / `Union@2025`

### Local Testing Verification
```bash
# Verify backend is running
curl http://localhost:8080/health
# Should return: {"ok":true}

# Verify frontend can connect
# Login on browser 1, add employee
# Open incognito/another browser, login with same dealer
# Employee should appear (data synced via API)
```

## Deploy to Render (Full Stack with Cross-Device Sync)

This project is configured for full-stack deployment with backend API + frontend.

[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy?repo=https://github.com/farhanrafiq/union)

### Quick Deploy (Recommended)

1. **Create Neon Database** (Free Tier):
   - Sign up at [neon.tech](https://neon.tech)
   - Create a new project
   - Copy the connection string (format: `postgresql://user:pass@host.neon.tech/dbname?sslmode=require`)

2. **Deploy to Render**:
   - Click "Deploy to Render" button above OR connect repo at [dashboard.render.com](https://dashboard.render.com)
   - Render will detect `render.yaml` and create:
     - **Backend API** (Web Service): Node.js + Express + Prisma
     - **Frontend** (Static Site): React + Vite
   - Set environment variables in Render dashboard:
     - Backend: `DATABASE_URL` (your Neon connection string)
     - Frontend: `VITE_API_URL` (auto-linked to backend URL)

3. **Initialize Database**:
   ```bash
   # After backend is deployed, run migrations via Render Shell:
   npm run migrate
   npm run seed
   ```

4. **Done!** Your app now syncs data across all devices.

### What Gets Deployed

**Backend API** (`union-registry-api`):
- Express server with authentication (JWT)
- Prisma ORM connected to Neon PostgreSQL
- Endpoints: /api/auth, /api/customers, /api/employees, /api/admin, /api/audit, /api/search

**Frontend** (`union-registry-frontend`):
- React + Vite SPA
- Automatically configured to use backend API
- Falls back to localStorage if API unavailable

### Environment Variables Setup

**Backend (Web Service)**:
```
DATABASE_URL=postgresql://user:pass@host.neon.tech/dbname?sslmode=require
JWT_SECRET=<auto-generated by Render>
NODE_ENV=production
```

**Frontend (Static Site)**:
```
VITE_API_URL=<auto-linked to backend URL>
```

### Manual Configuration (Alternative)

If not using the Deploy button:

1. **Backend Web Service**:
   - Root Directory: `server`
   - Build Command: `npm ci && npm run generate && npm run build`
   - Start Command: `npm start`
   - Add environment variables listed above

2. **Frontend Static Site**:
   - Root Directory: `.` (project root)
   - Build Command: `npm ci && npm run build`
   - Publish Directory: `dist`
   - Add `VITE_API_URL` pointing to backend

### Verification

After deployment:
1. Frontend URL: `https://union-registry-frontend.onrender.com`
2. Backend API: `https://union-registry-api.onrender.com/health` (should return `{"ok":true}`)
3. Test cross-device: Login on device 1, add data, login on device 2 → data appears ✅

For detailed troubleshooting, see [DEPLOYMENT.md](./DEPLOYMENT.md).

## Optional: Shared data across devices (Backend API)

By default, data is stored in the browser (localStorage), which is per-device. To share data across devices, the included backend API (Express + Prisma + PostgreSQL) in the `server/` folder is ready to deploy.

**Local development**: See "Run Locally (Full Stack)" section above

**Production deployment**: See "Deploy to Render (Full Stack with Cross-Device Sync)" section above

**Detailed deployment guide**: [DEPLOYMENT.md](./DEPLOYMENT.md) has step-by-step instructions with screenshots.

### What syncs across devices (when API is configured)

- ✅ **Admin Panel**: Dealer management, audit logs, global search
- ✅ **Dealer Authentication**: JWT-based login with password reset
- ✅ **Customers**: Create, update, terminate (shared across all dealer logins)
- ✅ **Employees**: Create, update, terminate with Aadhar uniqueness check
- ✅ **Cross-device real-time**: Add data on phone → immediately visible on laptop
- ✅ **Audit trails**: All admin actions logged with timestamps

### Features

- **Admin Dashboard**: Manage dealers, view audit logs, global search
- **Dealer Portal**: Manage customers and employees
- **Authentication**: Secure JWT-based auth with role separation (admin vs dealer)
- **Validation**: Phone numbers (10 digits), Aadhar uniqueness with conflict details
- **Responsive**: Works on desktop, tablet, and mobile
- **Offline-ready**: Falls back to localStorage if API unavailable

## Technology Stack

- **Frontend**: React 19, TypeScript, Vite, Tailwind CSS
- **Backend**: Express 4, Prisma ORM, JWT authentication
- **Database**: PostgreSQL (Neon serverless recommended)
- **Deployment**: Render (Web Service + Static Site)

## Support

For deployment issues or questions, see [DEPLOYMENT.md](./DEPLOYMENT.md) or open an issue on GitHub.
